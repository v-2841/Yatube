{% extends 'base.html' %}
{% load thumbnail %}
{% load tz %}
{% block title %}
–ü–æ—Å—Ç {{ post.text|truncatechars:30 }}
{% endblock %}
{% block content %}
<div class="row">
  <aside class="col-12 col-md-3">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        –ê–≤—Ç–æ—Ä: <a href="{% url 'posts:profile' post.author.username %}" class="text-decoration-none" >{% if post.author.get_full_name %}{{ post.author.get_full_name }}{% else %}{{ post.author.username }}{% endif %}</a>
      </li>
      <li class="list-group-item d-flex justify-content-between align-items-center">
        –í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∞: {{ post.author.posts.count }}
      </li>
      {% if post.group %}
      <li class="list-group-item">
        –ì—Ä—É–ø–ø–∞: <a href="{% url 'posts:group_list' post.group.slug %}" class="text-decoration-none" >{{ post.group.title }}</a>
      </li>
      {% endif %}
      <li class="list-group-item">
        {% if request.COOKIES.timezone %}
          {% timezone request.COOKIES.timezone %}
            <p><a href="{% url 'posts:post_detail' post.id %}" class="text-decoration-none" > {{ post.pub_date|date:"d E Y H:i" }}</a></p>
          {% endtimezone %}
        {% elif timezone %}
          {% timezone timezone %}
            <p><a href="{% url 'posts:post_detail' post.id %}" class="text-decoration-none" > {{ post.pub_date|date:"d E Y H:i" }}</a></p>
          {% endtimezone %}
        {% else %}
          <p><a href="{% url 'posts:post_detail' post.id %}" class="text-decoration-none" > {{ post.pub_date|date:"d E Y H:i" }}</a></p>
        {% endif %}
      </li>
    </ul>
  </aside>
  <article class="col-12 col-md-9">
    <br>
    <p>
      {{ post.text|linebreaksbr }}
    </p>
    {% if post.image %}
      <div class="text-center">
        {% if post.image|is_portrait %}
          {% thumbnail post.image "x720" crop="center" as im %}
            <img class="card-img mb-4 mt-4" src="{{ im.url }}" style="max-width:720px; max-height:720px; object-fit: contain;">
          {% endthumbnail %}
        {% else %}
          {% thumbnail post.image "720" crop="center" as im %}
            <img class="card-img mb-4 mt-4" src="{{ im.url }}" style="max-width:720px; max-height:720px; object-fit: contain;">
          {% endthumbnail %}
        {% endif %}
      </div>
    {% endif %}
    <ul class="list-group list-group-horizontal-sm mb-2">
      {% if post.likes.count > 0 %}
      <li class="dropdown list-group-item">
        <a class="text-decoration-none text-dark dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          –õ–∞–π–∫–∏: {{ post.likes.count }}
        </a>
        <ul class="dropdown-menu">
          {% for like in likes %}
            {% if like.user.get_full_name %}
            <li><a class="dropdown-item" href="{% url 'posts:profile' like.user.username %}">{{ like.user.get_full_name }}</a></li>
            {% else %}
            <li><a class="dropdown-item" href="{% url 'posts:profile' like.user.username %}">{{ like.user.username }}</a></li>
            {% endif %}
          {% endfor %}
          {% if post.likes.count > likes_num %}
            <li><a class="dropdown-item" href="{% url 'posts:post_likes' post.id %}"> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ </a></li>
          {% endif %}
        </ul>
      </li>
      {% else %}
        <li class="list-group-item"> –õ–∞–π–∫–∏: 0 </li>
      {% endif %}
      <li class="list-group-item"> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {{ post.comments.count }} </li>
    </ul>
    {% if not user.is_authenticated %}
      <br>
      <a href="{% url 'users:login' %}" class="text-decoration-none" > –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫ –∏–ª–∏ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å </a>
    {% else %}
      {% if liked %}
        <a href="{% url 'posts:post_dislike' post.id %}" class="btn btn-secondary mb-2 mt-2 me-2" > –î–∏–∑–ª–∞–π–∫ </a>
      {% else %}
        <a href="{% url 'posts:post_like' post.id %}" class="btn btn-primary mb-2 mt-2 me-2" > –ü–æ—Å—Ç–∞–≤–∏—Ç—å üëç </a>
      {% endif %}
    {% endif %}
    {% if user == post.author %}
      <br>
      <a class="btn btn-primary mb-2 mt-2 me-2" href="{% url 'posts:post_edit' post.id %}" >
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
      </a>
      <br>
      <a class="btn btn-danger mb-2 mt-2 me-2" href="{% url 'posts:post_delete' post.id %}">
        –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
      </a>
    {% endif %}
    {% include 'posts/includes/comments.html' %}
  </article>
</div>
{% endblock %}